---
title: "最佳实践"
linkTitle: "最佳实践"
weight: 20
---

# 概述

这里的最佳实践，主要是使用 Libvirt 工具集对虚拟机的全生命周期进行管理。比如创建、修改、删除虚拟机。

最常用的工具是 virt-manager 和 virt-install 命令


# 为 Domain 添加磁盘

```bash
export DOMAIN="tj-test-spst-nfs"
qemu-img create -f qcow2 /var/lib/libvirt/images/${DOMAIN}-data-1.qcow2 1T
virsh attach-disk ${DOMAIN} --source /var/lib/libvirt/images/${DOMAIN}-data-1.qcow2 \
--driver qemu --subdriver qcow2 \
--target vdb --targetbus virtio \
--cache none \
--persistent
```

将会生成如下 xml

```xml
    <disk type='file' device='disk'>
      <driver name='qemu' type='qcow2' cache='none'/>
      <source file='/var/lib/libvirt/images/disk.qcow2'/>
      <target dev='vdb' bus='virtio'/>
      <address type='pci' domain='0x0000' bus='0x07' slot='0x00' function='0x0'/>
    </disk>
```