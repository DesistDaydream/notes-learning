---
title: Docker æƒé™ç®¡ç†
---

# æ¦‚è¿°

# Docker Capabilities

Capabilities è¯¦è§ [Linux Capabilities æƒé™ç®¡ç†ç« èŠ‚](âœIT å­¦ä¹ ç¬”è®°/ğŸ“„1.æ“ä½œç³»ç»Ÿ/5.ç™»å½•%20Linux%20 ä¸%20 è®¿é—®æ§åˆ¶/Access%20Control(è®¿é—®æ§åˆ¶)/Capabilities(èƒ½åŠ›)%20 ç®¡ç†.md Linux ä¸ è®¿é—®æ§åˆ¶/Access Control(è®¿é—®æ§åˆ¶)/Capabilities(èƒ½åŠ›) ç®¡ç†.md)

æˆ‘ä»¬è¯´ Docker å®¹å™¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥ç†è®ºä¸Šå®¹å™¨å°±ä¼šå’Œè¿›ç¨‹ä¸€æ ·ä¼šæœ‰ä¸€äº›é»˜è®¤çš„å¼€æ”¾æƒé™ï¼Œé»˜è®¤æƒ…å†µä¸‹ Docker ä¼šåˆ é™¤å¿…é¡»çš„ `capabilities` ä¹‹å¤–çš„æ‰€æœ‰ `capabilities`ï¼Œå› ä¸ºåœ¨å®¹å™¨ä¸­æˆ‘ä»¬ç»å¸¸ä¼šä»¥ root ç”¨æˆ·æ¥è¿è¡Œï¼Œä½¿ç”¨ `capabilities` ç°åœ¨åï¼Œå®¹å™¨ä¸­çš„ä½¿ç”¨çš„ root ç”¨æˆ·æƒé™å°±æ¯”æˆ‘ä»¬å¹³æ—¶åœ¨å®¿ä¸»æœºä¸Šä½¿ç”¨çš„ root ç”¨æˆ·æƒé™è¦å°‘å¾ˆå¤šäº†ï¼Œè¿™æ ·å³ä½¿å‡ºç°äº†å®‰å…¨æ¼æ´ï¼Œä¹Ÿå¾ˆéš¾ç ´åæˆ–è€…è·å–å®¿ä¸»æœºçš„ root æƒé™ï¼Œæ‰€ä»¥ Docker æ”¯æŒ `Capabilities` å¯¹äºå®¹å™¨çš„å®‰å…¨æ€§æ¥è¯´æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚
ä¸è¿‡æˆ‘ä»¬åœ¨è¿è¡Œå®¹å™¨çš„æ—¶å€™å¯ä»¥é€šè¿‡æŒ‡å®š `--privileded` å‚æ•°æ¥å¼€å¯å®¹å™¨çš„è¶…çº§æƒé™ï¼Œè¿™ä¸ªå‚æ•°ä¸€å®šè¦æ…ç”¨ï¼Œå› ä¸ºä»–ä¼šè·å–ç³»ç»Ÿ root ç”¨æˆ·æ‰€æœ‰èƒ½åŠ›èµ‹å€¼ç»™å®¹å™¨ï¼Œå¹¶ä¸”ä¼šæ‰«æå®¿ä¸»æœºçš„æ‰€æœ‰è®¾å¤‡æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ï¼Œæ‰€ä»¥æ˜¯éå¸¸å±é™©çš„æ“ä½œã€‚
ä½†æ˜¯å¦‚æœä½ ç¡®å®éœ€è¦ä¸€äº›ç‰¹æ®Šçš„æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `--cap-add` å’Œ `--cap-drop` è¿™ä¸¤ä¸ªå‚æ•°æ¥åŠ¨æ€è°ƒæ•´ï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°ä¿è¯å®¹å™¨çš„ä½¿ç”¨å®‰å…¨ã€‚ä¸‹é¢è¡¨æ ¼ä¸­åˆ—å‡ºçš„ `Capabilities` æ˜¯ Docker é»˜è®¤ç»™å®¹å™¨æ·»åŠ çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `--cap-drop` å»é™¤å…¶ä¸­ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼š
![](https://notes-learning.oss-cn-beijing.aliyuncs.com/hlragi/1621522556084-0aa763d8-6f2d-4e2f-8f69-1953f75511be.png)docker capabilities
ä¸‹é¢è¡¨æ ¼ä¸­åˆ—å‡ºçš„ `Capabilities` æ˜¯ Docker é»˜è®¤åˆ é™¤çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`--cap-add`æ·»åŠ å…¶ä¸­ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼š
![](https://notes-learning.oss-cn-beijing.aliyuncs.com/hlragi/1621522556093-902979da-99b9-479e-8b11-db55a3d83605.png)docker drop capabilities

> `--cap-add`å’Œ`--cap-drop` è¿™ä¸¤å‚æ•°éƒ½æ”¯æŒ`ALL`å€¼ï¼Œæ¯”å¦‚å¦‚æœä½ æƒ³è®©æŸä¸ªå®¹å™¨æ‹¥æœ‰é™¤äº†`MKNOD`ä¹‹å¤–çš„æ‰€æœ‰å†…æ ¸æƒé™ï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š `$ sudo docker run --cap-add=ALL --cap-drop=MKNOD ...`

æ¯”å¦‚ç°åœ¨æˆ‘ä»¬éœ€è¦ä¿®æ”¹ç½‘ç»œæ¥å£æ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰æƒé™çš„ï¼Œå› ä¸ºéœ€è¦çš„ `NET_ADMIN` è¿™ä¸ª `Capabilities` é»˜è®¤è¢«ç§»é™¤äº†ï¼š

    $ docker run -it --rm busybox /bin/sh
    / # ip link add dummy0 type dummy
    ip: RTNETLINK answers: Operation not permitted
    / #

æ‰€ä»¥åœ¨ä¸ä½¿ç”¨ `--privileged` çš„æƒ…å†µä¸‹ï¼ˆä¸å»ºè®®ï¼‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `--cap-add=NET_ADMIN` å°†è¿™ä¸ª `Capabilities` æ·»åŠ å›æ¥ï¼š

    $ docker run -it --rm --cap-add=NET_ADMIN busybox /bin/sh
    / # ip link add dummy0 type dummy
    / #

å¯ä»¥çœ‹åˆ°å·²ç» OK äº†ã€‚
