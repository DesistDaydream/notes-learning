---
title: 数据库
---

# 概述

想要通过代码来控制数据库，那么在代码中，首先需要连接到数据库，只有打开了一个连接（socket），才可以通过代码来对数据库进行操作

而一般情况下，数据库并不是通过 go 语言写的，那么如何连接呢，就需要调用数据库的 API 接口，而想要调用该接口，则需要使用第三方库才可以，这个第三方库，这个库会提供几种"method"，包括连接数据库，对数据库执行操作等。

# ORM

Gorm # <https://github.com/jinzhu/gorm>

## 常见问题

### 为 For 循环中的多个 Or 创建分组

<https://github.com/go-gorm/gorm/issues/5052>

```go
			for _, field := range queryCardDesc.QField {
				result = result.Or(field+" LIKE ?", "%"+queryCardDesc.Keyword+"%")
			}
```

上面的例子通过 `result=result.Where(result)` 分组将会异常，产生多次 SQL，就像这样：`SELECT count(*) FROM `card_descs` WHERE (effect LIKE '%奥米加%' OR sc_name LIKE '%奥米加%' OR evo_cover_effect LIKE '%奥米加%') OR sc_name LIKE '%奥米加%' OR evo_cover_effect LIKE '%奥米加%' OR effect LIKE '%奥米加%' AND color LIKE '%红%'`

# Redis

`go get -u -v github.com/garyburd/redigo/redis`

```go
package main

import (
	"fmt"
	"github.com/garyburd/redigo/redis" // 引入redis第三方库
)

func main() {
    // 连接到redis
     c, err := redis.Dial("tcp", "127.0.0.1:6379")
	if err != nil {
		fmt.Println("Connect to redis error", err)
		return
	}
    // 注意关闭连接
	defer c.Close()
    // 通过go代码向redis写入数据
	_, err = c.Do("SET", "mykey", "superWang")
	if err != nil {
		fmt.Println("redis set failed:", err)
	}
    // 通过go代码读取redis中的数据，由于返回的值为 interface{} ，所以需要转换成字符串，才能正常显示
	username, err := redis.String(c.Do("GET", "mykey"))
	if err != nil {
		fmt.Println("redis get failed:", err)
	} else {
		fmt.Printf("Get mykey: %v \n", username)
	}
}
```
