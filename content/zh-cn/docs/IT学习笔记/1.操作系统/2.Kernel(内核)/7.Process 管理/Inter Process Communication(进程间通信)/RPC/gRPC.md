---
title: gRPC
---

# æ¦‚è¿°
> å‚è€ƒï¼š
> - [GitHub ç»„ç»‡ï¼Œgrpc](https://github.com/grpc)
> - [å®˜ç½‘](https://grpc.io/)

**Google Remote Procedure Calls(è°·æ­Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œç®€ç§° gRPC)** æ˜¯ä¸€ä¸ªå¼€æºçš„ RPC ç³»ç»Ÿï¼Œæœ€åˆäº 2015 å¹´åœ¨ Google å¼€å‘ï¼Œä½œä¸ºä¸‹ä¸€ä»£ RPC åŸºç¡€è®¾æ–½ Stubbyã€‚å®ƒä½¿ç”¨ HTTP/2 è¿›è¡Œä¼ è¾“ï¼ŒProtocol Buffers ä½œä¸ºæ¥å£æè¿°è¯­è¨€ï¼Œå¹¶æä¾›èº«ä»½éªŒè¯ã€åŒå‘æµå’Œæµé‡æ§åˆ¶ã€é˜»å¡æˆ–éé˜»å¡ç»‘å®šä»¥åŠå–æ¶ˆå’Œè¶…æ—¶ç­‰åŠŸèƒ½ã€‚å®ƒä¸ºå¤šç§è¯­è¨€ç”Ÿæˆè·¨å¹³å°çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»‘å®šã€‚æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬åœ¨å¾®æœåŠ¡é£æ ¼æ¶æ„ä¸­è¿æ¥æœåŠ¡ï¼Œæˆ–å°†ç§»åŠ¨è®¾å¤‡å®¢æˆ·ç«¯è¿æ¥åˆ°åç«¯æœåŠ¡ã€‚

gRPC å¯¹ HTTP/2 çš„å¤æ‚ä½¿ç”¨ä½¿å¾—æ— æ³•åœ¨æµè§ˆå™¨ä¸­å®ç° gRPC å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯éœ€è¦ä»£ç†ã€‚

# gRPC é•¿è¿æ¥åœ¨å¾®æœåŠ¡ä¸šåŠ¡ç³»ç»Ÿä¸­çš„å®è·µ

[gRPC é•¿è¿æ¥åœ¨å¾®æœåŠ¡ä¸šåŠ¡ç³»ç»Ÿä¸­çš„å®è·µ](https://mp.weixin.qq.com/s/DNHGBCZDdRjBXX0IaIZhwQ)

ä½œè€… | å¼ ç¦

é•¿è¿æ¥å’ŒçŸ­è¿æ¥å“ªä¸ªæ›´å¥½ï¼Œ ä¸€ç›´æ˜¯è¢«äººåå¤è®¨è®ºä¸”ä¹æ­¤ä¸ç–²çš„è¯é¢˜ã€‚æœ‰äººè¿½æ±‚çŸ­è¿æ¥çš„ç®€å•å¯é ï¼Œ æœ‰äººå´å¯¹é•¿è¿æ¥çš„ä½å»¶æ—¶è¶‹ä¹‹è‹¥é¹œã€‚é‚£ä¹ˆé•¿è¿æ¥åˆ°åº•å¥½åœ¨å“ªé‡Œï¼Œ å®ƒæ˜¯å¦æ˜¯è§£å†³æ€§èƒ½é—®é¢˜çš„é“¶å¼¹? æœ¬æ–‡å°±ä» gRPC é•¿è¿æ¥çš„è§†è§’ï¼Œ ä¸ºä½ æ­å¼€è¿™å±‚é¢çº±ã€‚

1 ä»€ä¹ˆæ˜¯é•¿è¿æ¥

HTTP é•¿è¿æ¥, åˆç§°ä¸º HTTP persistent connection, ä¹Ÿç§°ä½œ HTTP keep-alive æˆ– HTTP connection reuse, æ˜¯æŒ‡åœ¨ä¸€æ¡ TCP è¿æ¥ä¸Šå‘èµ·å¤šä¸ª HTTP è¯·æ±‚ / åº”ç­”çš„ä¸€ç§äº¤äº’æ¨¡å¼ã€‚

é‚£ä¹ˆä»€ä¹ˆæ˜¯é•¿è¿æ¥, ä»€ä¹ˆæ˜¯çŸ­è¿æ¥? ä»–ä»¬å’Œ TCP æœ‰ä»€ä¹ˆå…³ç³»å‘¢?

ä¸ºäº†ç†è§£è¿™ä¸ªæ¦‚å¿µ, æˆ‘ä»¬æ¥çœ‹ä¸‹å›¾ä¸­ TCP è¿æ¥çš„ä¸‰ç§è¡Œä¸ºã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

å›¾ä¸€ å±•ç¤ºäº† client å’Œ server ç«¯åŸºäº TCP åè®®çš„ä¸€æ¬¡äº¤äº’è¿‡ç¨‹ï¼Œ åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ: ä¸‰æ¬¡æ¡æ‰‹ï¼Œ æ•°æ®äº¤æ¢å’Œå››æ¬¡æŒ¥æ‰‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œ ä½†æ˜¯å®é™…åº”ç”¨ä¸­å­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚å‡å¦‚ server å¤„ç†è¯·æ±‚è¿‡ç¨‹éå¸¸è€—æ—¶ï¼Œ æˆ–è€…ä¸å¹¸çªç„¶å®•æœºï¼Œ æ­¤æ—¶ client ä¼šé™·å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ TCP åœ¨å…·ä½“çš„å®ç°ä¸­åŠ å…¥äº† keepaliveã€‚

å›¾äºŒ å±•ç¤ºäº† keepalive çš„å·¥ä½œæœºåˆ¶ã€‚å½“è¯¥æœºåˆ¶å¼€å¯ä¹‹åï¼Œ ç³»ç»Ÿä¼šä¸ºæ¯ä¸€ä¸ªè¿æ¥è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œ ä¸æ–­åœ°å‘é€ ACK åŒ…ï¼Œ ç”¨æ¥æ¢æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜æ´»ï¼Œ å½“å¯¹æ–¹ä¸»æœºå®•æœºæˆ–è€…ç½‘ç»œä¸­æ–­æ—¶ï¼Œ ä¾¿èƒ½åŠæ—¶çš„å¾—åˆ°åé¦ˆå¹¶é‡Šæ”¾èµ„æºã€‚

åœ¨å›¾ä¸€å’Œå›¾äºŒä¸­å¯ä»¥çœ‹åˆ°ï¼Œ è™½ç„¶è¿æ¥çš„æŒç»­æ—¶é—´ä¸åŒï¼Œ ä½†ä»–ä»¬çš„è¡Œä¸ºç±»ä¼¼ï¼Œ éƒ½æ˜¯å®Œæˆäº†ä¸€æ¬¡æ•°æ®äº¤äº’åä¾¿æ–­å¼€äº†è¿æ¥ï¼Œ å¦‚æœæœ‰æ›´å¤šçš„è¯·æ±‚è¦å‘é€ï¼Œ å°±éœ€è¦é‡æ–°å»ºç«‹è¿æ¥ã€‚è¿™ç§è¡Œä¸ºæ¨¡å¼è¢«ç§°ä¸ºçŸ­è¿æ¥ã€‚

é‚£æœ‰æ²¡æœ‰å¯èƒ½åœ¨å®Œæˆæ•°æ®äº¤äº’åä¸æ–­å¼€è¿æ¥ï¼Œ è€Œæ˜¯å¤ç”¨å®ƒç»§ç»­ä¸‹ä¸€æ¬¡è¯·æ±‚å‘¢?

å›¾ä¸‰ å±•ç¤ºäº†è¿™ç§äº¤äº’çš„è¿‡ç¨‹ã€‚åœ¨ client å’Œ server ç«¯å®Œæˆäº†ä¸€æ¬¡æ•°æ®äº¤æ¢åï¼Œ client é€šè¿‡ keepalive æœºåˆ¶ä¿æŒè¯¥è¿æ¥ï¼Œ åé¢çš„è¯·æ±‚ä¼šç›´æ¥å¤ç”¨è¯¥è¿æ¥ï¼Œ æˆ‘ä»¬ç§°è¿™ç§æ¨¡å¼ä¸ºé•¿è¿æ¥ã€‚

ç†è§£äº†ä¸Šé¢çš„è¿‡ç¨‹ï¼Œ æˆ‘ä»¬ä¾¿å¯ä»¥å¾—å‡ºä¸‹é¢çš„ç»“è®ºï¼š

1. TCP è¿æ¥æœ¬èº«å¹¶æ²¡æœ‰é•¿çŸ­çš„åŒºåˆ†ï¼Œ é•¿æˆ–çŸ­åªæ˜¯åœ¨æè¿°æˆ‘ä»¬ä½¿ç”¨å®ƒçš„æ–¹å¼
2. é•¿ / çŸ­æ˜¯æŒ‡å¤šæ¬¡æ•°æ®äº¤æ¢èƒ½å¦å¤ç”¨åŒä¸€ä¸ªè¿æ¥ï¼Œ è€Œä¸æ˜¯æŒ‡è¿æ¥çš„æŒç»­æ—¶é—´
3. TCP çš„ keepalive ä»…èµ·åˆ°ä¿æ´»æ¢æµ‹çš„ä½œç”¨ï¼Œ å’Œè¿æ¥çš„é•¿çŸ­å¹¶æ²¡æœ‰å› æœå…³ç³»

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ åœ¨ HTTP/1.x åè®®ä¸­ä¹Ÿæœ‰ Keep-Alive çš„æ¦‚å¿µã€‚å¦‚ä¸‹å›¾ï¼Œ é€šè¿‡åœ¨æŠ¥æ–‡å¤´éƒ¨ä¸­è®¾ç½® connection: Keep-Alive å­—æ®µæ¥å‘ŠçŸ¥å¯¹æ–¹è‡ªå·±æ”¯æŒå¹¶æœŸæœ›ä½¿ç”¨é•¿è¿æ¥é€šä¿¡ï¼Œ è¿™å’Œ TCP keepalive ä¿æ´»æ¢æµ‹çš„ä½œç”¨æ˜¯å®Œå…¨ä¸åŒçš„ã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

2 é•¿è¿æ¥çš„ä¼˜åŠ¿

ç›¸æ¯”äºçŸ­è¿æ¥ï¼Œé•¿è¿æ¥å…·æœ‰ï¼š

1. è¾ƒä½çš„å»¶æ—¶ã€‚ç”±äºè·³è¿‡äº†ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œé•¿è¿æ¥æ¯”çŸ­è¿æ¥æœ‰æ›´ä½çš„å»¶è¿Ÿã€‚
2. è¾ƒä½çš„å¸¦å®½å ç”¨ã€‚ç”±äºä¸ç”¨ä¸ºæ¯ä¸ªè¯·æ±‚å»ºç«‹å’Œå…³é—­è¿æ¥ï¼Œé•¿è¿æ¥äº¤æ¢æ•ˆç‡æ›´é«˜ï¼Œç½‘ç»œå¸¦å®½å ç”¨æ›´å°‘ã€‚
3. è¾ƒå°‘çš„ç³»ç»Ÿèµ„æºå ç”¨ã€‚server ä¸ºäº†ç»´æŒè¿æ¥ï¼Œä¼šä¸ºæ¯ä¸ªè¿æ¥åˆ›å»º socketï¼Œåˆ†é…æ–‡ä»¶å¥æŸ„ï¼Œ åœ¨å†…å­˜ä¸­åˆ†é…è¯»å†™ bufferï¼Œè®¾ç½®å®šæ—¶å™¨è¿›è¡Œ keepaliveã€‚å› æ­¤æ›´å°‘çš„è¿æ¥æ•°ä¹Ÿæ„å‘³ç€æ›´å°‘çš„èµ„æºå ç”¨ã€‚

å¦å¤–ï¼Œ gRPC ä½¿ç”¨ HTTP/2.0 ä½œä¸ºä¼ è¾“åè®®ï¼Œ ä»è¯¥åè®®çš„è®¾è®¡æ¥è®²ï¼Œ é•¿è¿æ¥ä¹Ÿæ˜¯æ›´æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œ åŸå› å¦‚ä¸‹ï¼š

1. HTTP/2.0 çš„å¤šè·¯å¤ç”¨ï¼Œ ä½¿å¾—è¿æ¥çš„å¤ç”¨æ•ˆç‡å¾—åˆ°äº†è´¨çš„æå‡

HTTP/1.0 å¼€å§‹æ”¯æŒé•¿è¿æ¥ï¼Œ å¦‚ä¸‹å›¾ 1ï¼Œ è¯·æ±‚ä¼šåœ¨ client æ’é˜Ÿ (request queuing)ï¼Œ å½“å“åº”è¿”å›ä¹‹åå†å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚è€Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ ä»»ä½•ä¸€ä¸ªè¯·æ±‚å¤„ç†è¿‡æ…¢éƒ½ä¼šé˜»å¡æ•´ä¸ªæµç¨‹ï¼Œ è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸ºçº¿å¤´é˜»å¡é—®é¢˜ï¼Œ å³ Head-of-line blockingã€‚

HTTP/1.1 åšå‡ºäº†æ”¹è¿›ï¼Œ å…è®¸ client å¯ä»¥è¿ç»­å‘é€å¤šä¸ªè¯·æ±‚ï¼Œ ä½† server çš„å“åº”å¿…é¡»æŒ‰ç…§è¯·æ±‚å‘é€çš„é¡ºåºä¾æ¬¡è¿”å›ï¼Œ ç§°ä¸º Pipelining (server ç«¯å“åº”æ’é˜Ÿ)ï¼Œ å¦‚ä¸‹å›¾ 2ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†å¤ç”¨æ•ˆç‡ï¼Œ ä½†å¹¶æ²¡èƒ½è§£å†³çº¿å¤´é˜»å¡çš„é—®é¢˜ã€‚

HTTP/2.0 å¼•å…¥äº†åˆ†å¸§åˆ†æµçš„æœºåˆ¶ï¼Œ å®ç°äº†å¤šè·¯å¤ç”¨ (ä¹±åºå‘é€ä¹±åºæ¥å—)ï¼Œ å½»åº•çš„è§£å†³äº†çº¿å¤´é˜»å¡ï¼Œ æå¤§æé«˜äº†è¿æ¥å¤ç”¨çš„æ•ˆç‡ã€‚å¦‚ä¸‹å›¾ 3ã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

2. HTTP/2.0 çš„å•ä¸ªè¿æ¥ç»´æŒçš„æˆæœ¬æ›´é«˜

é™¤äº†åˆ†å¸§åˆ†æµä¹‹å¤–ï¼Œ HTTP/2.0 è¿˜åŠ å…¥äº†è¯¸å¦‚æµæ§åˆ¶å’ŒæœåŠ¡ç«¯æ¨é€ç­‰ç‰¹æ€§ï¼Œ è¿™ä¹Ÿä½¿å¾—åè®®å˜å¾—å¤æ‚ï¼Œ è¿æ¥çš„å»ºç«‹å’Œç»´æŠ¤æˆæœ¬å‡é«˜ã€‚

ä¸‹å›¾å±•ç¤ºäº† HTTP/1.1 ä¸€æ¬¡çŸ­è¿æ¥äº¤äº’çš„è¿‡ç¨‹ã€‚å¯ä»¥çœ‹åˆ°, æ¡æ‰‹å’ŒæŒ¥æ‰‹ä¹‹é—´, åªå‘ç”Ÿäº†ä¸¤æ¬¡æ•°æ®äº¤æ¢, ä¸€æ¬¡è¯·æ±‚ â‘  å’Œä¸€æ¬¡å“åº” â‘¡ã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

ä¸‹å›¾å±•ç¤ºäº† HTTP/2.0 ä¸€æ¬¡çŸ­è¿æ¥äº¤äº’è¿‡ç¨‹ï¼Œ æ¡æ‰‹å’ŒæŒ¥æ‰‹ä¹‹é—´ï¼Œ å‘ç”Ÿäº†å¤šè¾¾ 11 æ¬¡çš„æ•°æ®äº¤æ¢ã€‚é™¤äº† client ç«¯è¯·æ±‚ (header å’Œ body åˆ†æˆäº†ä¸¤ä¸ªæ•°æ®å¸§ï¼Œ äºç¬¬ â‘¤â‘¥ æ­¥åˆ†å¼€ä¼ è¾“ï¼‰å’Œ server ç«¯å“åº” (â‘¨) ä¹‹å¤–ï¼Œ è¿˜å¤¹æ‚ç€ä¸€äº›è¯¸å¦‚åè®®ç¡®è®¤ (â‘ ) ï¼Œ è¿æ¥é…ç½® (â‘¡â‘¢â‘£) ï¼Œ æµç®¡ç† (â‘¦â‘©) å’Œæ¢æµ‹ä¿æ´» (â‘§â‘ª) çš„è¿‡ç¨‹ã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼Œ HTTP/2.0 çš„è¿æ¥æ›´é‡ï¼Œ ç»´æŠ¤æˆæœ¬æ›´é«˜ï¼Œ ä½¿å¾—å¤ç”¨å¸¦æ¥çš„æ”¶ç›Šæ›´é«˜ã€‚

3 é•¿è¿æ¥ä¸æ˜¯é“¶å¼¹

è™½ç„¶é•¿è¿æ¥æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œ ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½é€‚ç”¨ã€‚åœ¨ä½¿ç”¨é•¿è¿æ¥ä¹‹å‰ï¼Œ è‡³å°‘æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‚¹éœ€è¦è€ƒè™‘ã€‚

1. client å’Œ server çš„æ•°é‡

é•¿è¿æ¥æ¨¡å¼ä¸‹ï¼Œ server è¦å’Œæ¯ä¸€ä¸ª client éƒ½ä¿æŒè¿æ¥ã€‚å¦‚æœ client æ•°é‡è¿œè¿œè¶…è¿‡ server æ•°é‡ï¼Œ ä¸æ¯ä¸ª client éƒ½ç»´æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œ å¯¹ server æ¥è¯´ä¼šæ˜¯ä¸€ä¸ªæå¤§çš„è´Ÿæ‹…ã€‚å¥½åœ¨è¿™ç§åœºæ™¯ä¸­ï¼Œ è¿æ¥çš„åˆ©ç”¨ç‡å’Œå¤ç”¨ç‡å¾€å¾€ä¸é«˜ï¼Œä½¿ç”¨ç®€å•ä¸”æ˜“äºç®¡ç†çš„çŸ­è¿æ¥æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å³ä½¿ç”¨é•¿è¿æ¥ï¼Œ ä¹Ÿå¿…é¡»è®¾ç½®ä¸€ä¸ªåˆç†çš„è¶…æ—¶æœºåˆ¶ï¼Œ å¦‚åœ¨ç©ºé—²æ—¶é—´è¿‡é•¿æ—¶æ–­å¼€è¿æ¥ï¼Œ é‡Šæ”¾ server èµ„æºã€‚

2. è´Ÿè½½å‡è¡¡æœºåˆ¶

ç°ä»£åç«¯æœåŠ¡ç«¯æ¶æ„ä¸­ï¼Œ ä¸ºäº†å®ç°é«˜å¯ç”¨å’Œå¯ä¼¸ç¼©ï¼Œ ä¸€èˆ¬éƒ½ä¼šå¼•å…¥å•ç‹¬çš„æ¨¡å—æ¥æä¾›è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œ ç§°ä¸ºè´Ÿè½½å‡è¡¡å™¨ã€‚æ ¹æ®å·¥ä½œåœ¨ OSI ä¸åŒçš„å±‚çº§ï¼Œ ä¸åŒçš„è´Ÿè½½å‡è¡¡å™¨ä¼šæä¾›ä¸åŒçš„è½¬å‘åŠŸèƒ½ã€‚æ¥ä¸‹æ¥å°±æœ€å¸¸è§çš„ L4 (å·¥ä½œåœ¨ TCP å±‚ï¼‰å’Œ L7 (å·¥ä½œåœ¨åº”ç”¨å±‚ï¼Œ å¦‚ HTTPï¼‰ ä¸¤ç§è´Ÿè½½å‡è¡¡å™¨æ¥åˆ†æã€‚

L4 è´Ÿè½½å‡è¡¡å™¨: åŸç†æ˜¯å°†æ”¶åˆ°çš„ TCP æŠ¥æ–‡ï¼Œ ä»¥ä¸€å®šçš„è§„åˆ™è½¬å‘ç»™åç«¯çš„æŸä¸€ä¸ª serverã€‚è¿™ä¸ªè½¬å‘è§„åˆ™å…¶å®æ˜¯åˆ°æŸä¸ª server åœ°å€çš„æ˜ å°„ã€‚ç”±äºå®ƒåªè½¬å‘ï¼Œ è€Œä¸ä¼šè¿›è¡ŒæŠ¥æ–‡è§£æï¼Œ å› æ­¤è¿™ç§åœºæ™¯ä¸‹ client ä¼šå’Œ server ç«¯æ¡æ‰‹åç›´æ¥å»ºç«‹è¿æ¥ï¼Œ å¹¶ä¸”æ‰€æœ‰çš„æ•°æ®æŠ¥æ–‡éƒ½åªä¼šè½¬å‘ç»™åŒä¸€ä¸ª serverã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ L4 ä¼šå°† 10.0.0.1:3001 çš„æµé‡å…¨éƒ¨è½¬å‘ç»™ 11.0.0.2:3110ã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

åœ¨çŸ­è¿æ¥æ¨¡å¼ä¸‹ï¼Œ ç”±äºè¿æ¥ä¼šä¸æ–­çš„å»ºç«‹å’Œå…³é—­ï¼Œ åŒä¸€ä¸ª client çš„æµé‡ä¼šè¢«åˆ†å‘åˆ°ä¸åŒçš„ serverã€‚

åœ¨é•¿è¿æ¥æ¨¡å¼ä¸‹ï¼Œ ç”±äºè¿æ¥ä¸€æ—¦å»ºç«‹ä¾¿ä¸ä¼šæ–­å¼€ï¼Œ å°±ä¼šå¯¼è‡´æµé‡ä¼šè¢«åˆ†å‘åˆ°åŒä¸€ä¸ª serverã€‚åœ¨ client ä¸ server æ•°é‡å·®è·ä¸å¤§ç”šè‡³ client å°‘äº server çš„æƒ…å†µä¸‹ï¼Œ å°±ä¼šå¯¼è‡´æµé‡åˆ†å‘ä¸å‡ã€‚å¦‚ä¸‹å›¾ä¸­ï¼Œ ç¬¬ä¸‰ä¸ª server ä¼šä¸€ç›´å¤„äºç©ºé—²çš„çŠ¶æ€ã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

ä¸ºäº†é¿å…è¿™ç§åœºæ™¯ä¸­è´Ÿè½½å‡è¡¡å¤±æ•ˆçš„æƒ…å†µï¼Œ L7 è´Ÿè½½å‡è¡¡å™¨ä¾¿æˆäº†ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚

L7 è´Ÿè½½å‡è¡¡å™¨: ç›¸æ¯” L4 åªèƒ½åŸºäºè¿æ¥è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œ L7 å¯ä»¥è¿›è¡Œ HTTP åè®®çš„è§£æ. å½“ client å‘é€è¯·æ±‚æ—¶ï¼Œ client ä¼šå…ˆå’Œ L7 æ¡æ‰‹ï¼Œ L7 å†å’Œåç«¯çš„ä¸€ä¸ªæˆ–å‡ ä¸ª server æ¡æ‰‹ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ç­–ç•¥å°†è¯·æ±‚åˆ†å‘ç»™è¿™äº› serverï¼Œå®ç°åŸºäºè¯·æ±‚çš„è´Ÿè½½å‡è¡¡. å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ10.0.0.1 é€šè¿‡é•¿è¿æ¥å‘å‡ºçš„å¤šä¸ªè¯·æ±‚ä¼šæ ¹æ® urlï¼Œ cookies æˆ– header è¢« L7 åˆ†å‘åˆ°åç«¯ä¸åŒçš„ serverã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

å› æ­¤ï¼Œå¿…é¡»è¦æ„è¯†åˆ°ï¼Œè™½ç„¶é•¿è¿æ¥å¯ä»¥å¸¦æ¥æ€§èƒ½çš„æå‡ï¼Œä½†å¦‚æœå¿½ç•¥äº†ä½¿ç”¨åœºæ™¯æˆ–æ˜¯é€‰æ‹©äº†é”™è¯¯çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç»“æœå¾ˆå¯èƒ½ä¼šé€‚å¾—å…¶åã€‚å®è·µä¸­ä¸€å®šè¦ç»“åˆå®é™…æƒ…å†µï¼Œ é¿å…å› é”™è¯¯çš„ä½¿ç”¨å¯¼è‡´æ€§èƒ½ä¸‹é™æˆ–è€…è´Ÿè½½å‡è¡¡å¤±æ•ˆçš„æƒ…å†µå‘ç”Ÿã€‚

4 Biz-UI å›¢é˜Ÿé•¿è¿æ¥å®è·µ

è¿æ¥çš„ç®¡ç†

Biz-UI çš„ä¸šåŠ¡ç³»ç»Ÿé‡‡ç”¨ Kubernetes + Istio æ¶æ„æ¥ä½œä¸ºç”Ÿäº§å¹³å°ã€‚Kubernetes è´Ÿè´£æœåŠ¡çš„éƒ¨ç½²ã€å‡çº§å’Œç®¡ç†ç­‰è¾ƒåŸºç¡€çš„åŠŸèƒ½ã€‚Istio è´Ÿè´£ä¸Šå±‚çš„æœåŠ¡æ²»ç†ï¼Œ åŒ…æ‹¬æµé‡ç®¡ç†ï¼Œ ç†”æ–­ï¼Œ é™æµé™çº§å’Œè°ƒç”¨é“¾æ²»ç†ç­‰ã€‚åœ¨è¿™ä¹‹ä¸Šï¼Œä¸šåŠ¡ç³»ç»ŸæœåŠ¡ä¹‹é—´åˆ™ä½¿ç”¨ gRPC è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚

Istio åŠŸèƒ½çš„å®ç°ä¾èµ–äºå…¶ä½¿ç”¨ sidecar (é»˜è®¤ä¸º Envoyï¼‰æ§åˆ¶ Pod çš„å…¥ç«™å‡ºç«™æµé‡ï¼Œ ä»æ¥è¿›è¡ŒåŠ«æŒå’Œä»£ç†è½¬å‘ã€‚

ä¸‹å›¾å±•ç¤ºäº† Istio ä¸­ä¸¤ä¸ª service æµé‡çš„è½¬å‘è¿‡ç¨‹ã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

è“è‰²éƒ¨åˆ†æ˜¯ Kubernetes çš„ä¸€äº›åŸºæœ¬ç»„ä»¶ï¼Œ å¦‚é›†ç¾¤å…ƒæ•°æ®å­˜å‚¨ä¸­å¿ƒ etcdï¼Œ æä¾›å…ƒæ•°æ®æŸ¥è¯¢å’Œç®¡ç†æœåŠ¡çš„ api-serverï¼Œ æœåŠ¡æ³¨å†Œä¸­å¿ƒ coreDNSï¼Œ è´Ÿè´£æµé‡è½¬å‘çš„ kube-proxy å’Œ iptablesã€‚

é»„è‰²çš„éƒ¨åˆ†æ˜¯ Istio å¼•å…¥çš„ Pilot å’Œ Envoy ç»„ä»¶ã€‚Pilot é€šè¿‡ list/watch api-server æ¥ä¸º Envoy æä¾›æœåŠ¡å‘ç°åŠŸèƒ½ã€‚Envoy åˆ™è´Ÿè´£æ¥ç®¡ Pod çš„å‡ºç«™å’Œå…¥ç«™æµé‡ï¼Œ ä»è€Œå®ç°è¿æ¥ç®¡ç†ï¼Œ ç†”æ–­é™æµç­‰åŠŸèƒ½ã€‚å’Œ nginx ç±»ä¼¼ï¼Œ Envoy ä¹Ÿæ˜¯å·¥ä½œåœ¨ç¬¬ä¸ƒå±‚ã€‚

ç»¿è‰²éƒ¨åˆ†è¡¨ç¤ºæä¾›ä¸šåŠ¡åŠŸèƒ½çš„ä¸¤ç§æœåŠ¡ï¼Œ è®¢å•æœåŠ¡ (Order) å’Œç”¨æˆ·æ•°æ®æœåŠ¡ (User)ã€‚

Order è°ƒç”¨ User æœåŠ¡çš„è¿‡ç¨‹ä¸ºï¼š

1. Order é€šè¿‡ coreDNS è§£æåˆ° User æœåŠ¡å¯¹åº”çš„ ClusterIPã€‚
2. å½“ Order å‘è¯¥ ClusterIP å‘é€è¯·æ±‚æ—¶ï¼Œ å®é™…ä¸Šæ˜¯åŒ Envoy ä»£ç†å»ºç«‹è¿æ¥ã€‚
3. Envoy æ ¹æ® Pilot çš„è·¯ç”±è§„åˆ™ï¼Œ ä» ClusterIP å¯¹åº”çš„å¤šä¸ª User Pod IP ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œ å¹¶åŒè¯¥ Pod çš„ Envoy ä»£ç†å»ºç«‹è¿æ¥ã€‚
4. æœ€åï¼Œ User çš„ Envoy ä»£ç†å†ä¸ User å»ºç«‹è¿æ¥ï¼Œ å¹¶è¿›è¡Œè¯·æ±‚è½¬å‘ã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ æ€»å…±æœ‰ä¸‰ä¸ªè¿æ¥è¢«å»ºç«‹ï¼š

- ç¬¬ä¸€ä¸ªè¿æ¥æ˜¯ Order -> Order Envoyï¼Œ æ˜¯ç”± Order å»ºç«‹å¹¶æ§åˆ¶ã€‚
- ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªè¿æ¥æ˜¯ Order Envoy -> User Envoy -> Userï¼Œ ç”± Envoy å‘èµ·å’Œå»ºç«‹ï¼Œ ä¸å— Order æ§åˆ¶ã€‚é»˜è®¤æ˜¯å·¥ä½œåœ¨é•¿è¿æ¥æ¨¡å¼ï¼Œ å¹¶é€šè¿‡è¿æ¥æ± è¿›è¡Œç»´æŠ¤ã€‚

å…·ä½“å®è·µä¸­ï¼Œ Envoy ä¼šé€‰æ‹©å»ºç«‹å¤šä¸ªè¿æ¥çš„æ–¹å¼æ¥æé«˜å¯ç”¨æ€§ã€‚å¦‚ä¸‹é¢çš„å›¾ç¤ºä¸­ï¼š

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

ç»¿è‰²çš„è¿æ¥è¡¨ç¤ºç”± Envoy ç®¡ç†çš„è¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ Order Envoy ä¼šé€‰æ‹©å¤šä¸ªä¸Šæ¸¸ User Envoyï¼Œå¹¶åˆ†åˆ«ä¸æ¯ä¸€ä¸ªå»ºç«‹ä¸¤ä¸ªé•¿è¿æ¥ã€‚åŒæ—¶ï¼Œæ¯ä¸ª User Envoy ä¹Ÿä¼šä¸ User å»ºç«‹å››æ¡é•¿è¿æ¥ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯ Envoy çš„è¡Œä¸ºï¼Œä¸å— Order è¿æ¥ (è“è‰²çš„éƒ¨åˆ†) çš„å½±å“ã€‚

è“è‰²çš„è¿æ¥è¡¨ç¤ºç”± Order ç®¡ç†çš„è¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯å»ºç«‹ N ä¸ªçŸ­è¿æ¥ (å›¾å·¦ä¸Šæ–¹ï¼‰è¿˜æ˜¯ä¸€ä¸ªé•¿è¿æ¥ (å›¾å³ä¸Šæ–¹ï¼‰ï¼ŒOrder å‘å‡ºçš„å¤šä¸ªè¯·æ±‚éƒ½ä¼šç»è¿‡ä¸¤å±‚é•¿è¿æ¥åˆ†å‘åˆ°ä¸åŒçš„ User å®ä¾‹ä¸Šï¼Œä»è€Œå®ç°åŸºäºè¯·æ±‚çš„è´Ÿè½½å‡è¡¡ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯, Order service ä¸­ä»£ç çš„å®ç°å†³å®šäº†è“è‰²çš„è¿æ¥ä¸ºé•¿è¿æ¥æˆ–çŸ­è¿æ¥, ä¸”ä¸ä¼šå½±å“ç»¿è‰²çš„éƒ¨åˆ†ã€‚

é•¿è¿æ¥çš„å®ç°

æˆ‘ä»¬ä»¥ä¸‹é¢çš„ proto æ–‡ä»¶ä¸ºä¾‹æ¥è®²è¿°åŸºäº Go è¯­è¨€çš„å®ç°ã€‚

```nginx
syntax = "proto3";
 package test;

 message HelloRequest {
   string message = 1;
 }

 message HelloResponse {
   string response = 1;
 }

 service TestService {
   rpc SayHello (HelloRequest) returns (HelloResponse) {
   }
Â }
```

proto ç”Ÿæˆå¯¹åº”çš„ client ä»£ç å¦‚ä¸‹ï¼š

```go
type TestServiceClient interface {
  SayHello(ctx context.Context, in *HelloRequest, opts ...grpc.CallOption)
(*HelloResponse, error)
}
type testServiceClient struct {
  cc *grpc.ClientConn
}

func NewTestServiceClient(cc *grpc.ClientConn) TestServiceClient {
  return &testServiceClient{cc}
}

func (c *testServiceClient) SayHello(ctx context.Context, in *HelloRequest,
opts ...grpc.CallOption) (*HelloResponse, error) {
  out := new(HelloResponse)
  err := grpc.Invoke(ctx, "/test.TestService/SayHello", in, out, c.cc, opts...)
  if err != nil {
    return nil, err
  }
  return out, nil
}
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ testServiceClient (ä»¥ä¸‹ç®€ç§° clientï¼‰ä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ grpc.ClientConn (ä»¥ä¸‹ç®€ç§° conï¼‰ï¼Œå®ƒä»£è¡¨äº†ä¸€æ¡ gRPC è¿æ¥ï¼Œç”¨æ¥æ‰¿æ‹…åº•å±‚å‘é€è¯·æ±‚å’Œæ¥å—å“åº”çš„åŠŸèƒ½ã€‚client å’Œ con æ˜¯ä¸€å¯¹ä¸€ç»‘å®šçš„ï¼Œä¸ºäº†è¿æ¥å¤ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå…¶ä¸­ä»»ä½•ä¸€ä¸ªæå–æˆå…±äº«å˜é‡ï¼Œå°†å…¶æ”¹å†™æˆå•ä¾‹æ¨¡å¼ã€‚

å‡å¦‚å°† con æå–æˆå…±äº«å˜é‡ï¼Œé‚£ä¹ˆæ¯æ¬¡å¤ç”¨çš„æ—¶å€™ï¼Œè¿˜éœ€ä¸ºå…¶æ–°å»ºä¸€ä¸ª client å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥å°† client æå–æˆå…±äº«å˜é‡ã€‚

é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªåŒ…çº§åˆ«å…±äº«å˜é‡ï¼Œ

```javascript

var internalTestServiceClientInstance proto.TestServiceClient


 var internalTestServiceClientMutex sync.Mutex
```

ç„¶åæˆ‘ä»¬æ„å»ºä¸€ä¸ª client çš„ä»£ç†ï¼Œå¯¹å¤–æš´éœ²æ–¹æ³•è°ƒç”¨ï¼Œå¯¹å†…æä¾›

```swift
internalTestServiceClientInstance çš„å°è£…ã€‚ç„¶åæŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼å®ç° SayHello
type internalTestServiceClient struct {
  dialOptions []grpc.DialOption
}
func (i *internalTestServiceClient) SayHello(ctx context.Context, req
*proto.HelloRequest, opts ...grpc.CallOption) (*proto.HelloResponse, error) {

  useLongConnection := grpcClient.UseLongConnection() && len(i.dialOptions) ==
0

  if useLongConnection && internalTestServiceClientInstance != nil {
    return internalTestServiceClientInstance.SayHello(ctx, req, opts...)
  }


  c, conn, err := getTestServiceClient(i.dialOptions...)
  if err != nil {
    return nil, err
  }

  if useLongConnection {
    internalTestServiceClientMutex.Lock()
    defer internalTestServiceClientMutex.Unlock()


    if internalTestServiceClientInstance == nil {
      internalTestServiceClientInstance = c
      log.Info("long connection established for internalTestServiceClient")
    } else {

      defer grpcClient.CloseCon(conn)
      log.Info("long connection for internalTestServiceClient has been
established, going to close current connection")
    }
  } else {

    defer grpcClient.CloseCon(conn)
  }

  return c.SayHello(ctx, req, opts...)
}
```

è¿™é‡Œéœ€è¦æ³¨æ„çš„å‡ ä¸ªç‚¹:

- client çš„å…±äº«è€Œä¸æ˜¯ con å±‚çš„å…±äº«
- æ‡’åŠ è½½
- DCL åŒæ£€æŸ¥é¿å…è¿æ¥æ³„éœ²
- å½“ä½¿ç”¨è‡ªå®šä¹‰çš„ dialOptions æ—¶ï¼Œ åˆ‡æ¢åˆ°çŸ­è¿æ¥æ¨¡å¼

æ€§èƒ½æµ‹è¯•

æˆ‘ä»¬åœ¨ Istio å¹³å°ä¸‹ï¼Œ å¯¹åŒä¸€ä¸ªæ¥å£åœ¨é•¿è¿æ¥å’ŒçŸ­è¿æ¥ä¸¤ç§æ¨¡å¼ä¸‹çš„å“åº”æ—¶é—´å’Œååé‡è¿›è¡Œäº†å‹åŠ›æµ‹è¯•ã€‚

é¦–å…ˆæ˜¯å¯¹å“åº”æ—¶é—´çš„æµ‹è¯•ï¼Œ ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

å¯¹çŸ­è¿æ¥æ¥è¯´ï¼Œ å½“å¹¶å‘æ•° <350 çš„ï¼Œ å“åº”æ—¶é—´å‘ˆçº¿æ€§å¢é•¿ï¼Œ å½“å¹¶å‘æ•°è¶…è¿‡ 350 æ—¶ï¼Œ å“åº”æ—¶é—´é™¡å¢ï¼Œ å¾ˆå¿«è¾¾åˆ°äº† 10s å¹¶å¼•å‘äº†è¶…æ—¶ã€‚

å¯¹é•¿è¿æ¥æ¥è¯´ï¼Œ å½“å¹¶å‘æ•° <500 æ—¶ï¼Œ å“åº”æ—¶é—´è™½ç„¶ä¹Ÿå‘ˆçº¿æ€§å¢é•¿ï¼Œ ä½†æ¯”çŸ­è¿æ¥è¦å°ã€‚å½“å¹¶å‘æ•°è¶…è¿‡ 500 æ—¶ï¼Œ å“åº”æ—¶é—´é™¡å¢å¹¶å¾ˆå¿«è¶…æ—¶ã€‚

æ¥ä¸‹æ¥æ˜¯ååé‡çš„æµ‹è¯•ï¼Œ ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://notes-learning.oss-cn-beijing.aliyuncs.com/80c0f93c-d902-44cb-90be-a670ed7b9f3d/640)

å¯¹çŸ­è¿æ¥æ¥è¯´ï¼Œ å½“å¹¶å‘æ•° <350 æ—¶ï¼Œ ååé‡åŸºæœ¬ç»´æŒåœ¨ 290ï¼Œ è¶…è¿‡ 350 ä¾¿å¼€å§‹éª¤å‡ã€‚

å¯¹é•¿è¿æ¥æ¥è¯´ï¼Œ å½“å¹¶å‘æ•° <500 æ—¶ï¼Œ ååé‡åŸºæœ¬ç»´æŒåœ¨ 325ï¼Œ è¶…è¿‡ 500 ä¾¿å¼€å§‹éª¤å‡ã€‚

ä»æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œ é•¿è¿æ¥å’ŒçŸ­è¿æ¥éƒ½å­˜åœ¨æ˜æ˜¾çš„æ€§èƒ½æ‹ç‚¹ (é•¿è¿æ¥ä¸º 500ï¼Œ çŸ­è¿æ¥ä¸º 350)ï¼Œ åœ¨åˆ°è¾¾æ‹ç‚¹ä¹‹å‰ï¼Œ æ€§èƒ½å˜åŒ–è¾ƒä¸ºå¹³ç¨³ï¼Œä¸€æ—¦è¶…è¿‡ä¾¿æ€¥å‰§ä¸‹é™ã€‚ä½†æ— è®ºæ˜¯ä»å“åº”æ—¶é—´ï¼ŒQPSï¼Œ æˆ–æ˜¯æ‹ç‚¹å€¼å¤§å°æ¥çœ‹ï¼Œ é•¿è¿æ¥éƒ½æ˜æ˜¾è¦ä¼˜äºçŸ­è¿æ¥ã€‚

5 æ€»ç»“

æœ¬æ–‡æ·±å…¥è§£é‡Šäº†é•¿è¿æ¥å’ŒçŸ­è¿æ¥æ¦‚å¿µï¼Œ å¹¶é˜è¿°äº†é•¿è¿æ¥çš„ä¼˜åŠ¿åŠä½¿ç”¨æ—¶åº”è€ƒè™‘çš„é—®é¢˜ã€‚ç»“åˆ Biz-UI çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œ åˆ†æäº† Istio å¹³å°ä¸­ gRPC è¿æ¥çš„ç®¡ç†æ–¹å¼å’Œé•¿è¿æ¥åŸºäº Go è¯­è¨€çš„å®ç°ï¼Œ å¹¶é€šè¿‡æ€§èƒ½æµ‹è¯•å±•ç¤ºäº†é•¿è¿æ¥å¸¦æ¥çš„å“åº”æ—¶é—´å’Œååé‡ä¸Šçš„æå‡ï¼Œ ä¸º gRPC æ¡†æ¶ä¸­ä½¿ç”¨é•¿è¿æ¥æä¾›äº†æœ‰åŠ›çš„ç†è®ºä¾æ®å’Œæ•°æ®æ”¯æŒã€‚

å¸Œæœ›æ­¤æ–‡ä¼šå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼

å‚è€ƒé“¾æ¥

ã€1ã€‘\[HTTP/2.0 - RFC7540]

https:// httpwg.org/specs/rfc7540.html

ã€2ã€‘\[TCP keepalive]

<https://www.freesoft.org/CIE/RFC/1122/71.htm>

ã€3ã€‘\[HTTP Keep-Alive]

<https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Keep-Alive>

ã€4ã€‘\[gRPC]

<https://grpc.io/>

ã€5ã€‘\[Istio]

<https://istio.io/>

ã€6ã€‘\[Kubernetes]

<https://kubernetes.io/>

ã€7ã€‘\[Envoy Doc]

<https://www.envoyproxy.io/docs/envoy/latest/>

ã€8ã€‘\[NGINX Layer 7 Load Balancing]

<https://www.nginx.com/resources/glossary/layer-7-load-balancing/>

ä½œè€…ç®€ä»‹

å¼ ç¦ï¼ŒFreeWheel Biz-UI å›¢é˜Ÿé«˜çº§ç ”å‘å·¥ç¨‹å¸ˆ, çƒ­è¡·äºæ–°æŠ€æœ¯çš„ç ”ç©¶ä¸åˆ†äº«ï¼Œæ“…é•¿å‘ç°ä¸è§£å†³åç«¯å¼€å‘ç—›ç‚¹ï¼Œç›®å‰è‡´åŠ›äº Goï¼Œå®¹å™¨åŒ–å’Œæ— æœåŠ¡åŒ–ç›¸å…³çš„å®è·µã€‚

ä»Šæ—¥æ¨èæ–‡ç« 

[Uber å¦‚ä½•è§£å†³ 2000 å¤šä¸ªå¾®æœåŠ¡å¸¦æ¥çš„å¤æ‚æ€§é—®é¢˜ï¼Ÿ](http://mp.weixin.qq.com/s?__biz=MzIzNjUxMzk2NQ==&mid=2247501832&idx=1&sn=1ee2d0258141540ea15dfe4ade286a35&chksm=e8d437cadfa3bedcf3726e70ad98d321fd6d565a739b53fe0eb28ac802b939a4e7cd2bbc789f&scene=21#wechat_redirect)

ç‚¹ä¸ªåœ¨çœ‹å°‘ä¸ª bugğŸ‘‡
