---
title: 1.Linux Kernel
---

# æ¦‚è¿°

> å‚è€ƒï¼š
> - [Linus Torvalds](https://github.com/torvalds)
> - [GitHub,Linux å†…æ ¸é¡¹ç›®](https://github.com/torvalds/linux)
> - [å®˜ç½‘](https://www.kernel.org/)
> - [å®˜æ–¹æ–‡æ¡£](https://www.kernel.org/doc/html/latest/)
> - [å®˜æ–¹ Manual(æ‰‹å†Œ)](https://www.kernel.org/doc/man-pages/index.html)
> - [Wiki,Kernel](<https://en.wikipedia.org/wiki/Kernel_(operating_system)>)
> - [Wiki,/boot](https://en.wikipedia.org/wiki//boot/)
> - [Wiki,vmlinux](https://en.wikipedia.org/wiki/Vmlinux)
> - [Wiki,Initial ramdisk](https://en.wikipedia.org/wiki/Initial_ramdisk)
> - [Wiki,System.map](https://en.wikipedia.org/wiki/System.map)
> - [æ ‘è“æ´¾ Linux](https://github.com/raspberrypi/linux)
> - [RedHat å®˜æ–¹æ–‡æ¡£,8-ç®¡ç†ã€ç›‘æ§å’Œæ›´æ–°å†…æ ¸](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_monitoring_and_updating_the_kernel/index)
> - <http://www.linfo.org/vmlinuz.html>
> - [çŸ¥ä¹,initrd å’Œ initramfs çš„åŒºåˆ«](https://www.zhihu.com/question/22045825)

**Kernel(å†…æ ¸) **æ˜¯ä¸€ä¸ªä½œä¸ºæ“ä½œç³»ç»Ÿæ ¸å¿ƒçš„è®¡ç®—æœºç¨‹åºï¼Œå¯¹ç³»ç»Ÿä¸­çš„ä¸€åˆ‡å…·æœ‰å®Œå…¨æ§åˆ¶æƒã€‚å®ƒè´Ÿè´£ç®¡ç†ç³»ç»Ÿçš„è¿›ç¨‹ã€å†…å­˜ã€è®¾å¤‡é©±åŠ¨ç¨‹åºã€æ–‡ä»¶å’Œç½‘ç»œç³»ç»Ÿï¼Œå†³å®šç€ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚

Kernel æ˜¯è®¡ç®—å™¨å¯åŠ¨æ—¶é¦–å…ˆåŠ è½½ç¨‹åºä¹‹ä¸€(åœ¨ [Bootloader](/docs/ITå­¦ä¹ ç¬”è®°/1.æ“ä½œç³»ç»Ÿ/1.Bootloader/1.Bootloader.md)å¹¶å¤„ç†ç¡¬ä»¶å’Œè½¯ä»¶ä¹‹é—´çš„äº¤äº’ã€‚å¹¶ä¸”å¤„ç†å¯åŠ¨è¿‡ç¨‹çš„å…¶ä½™éƒ¨åˆ†ã€ä»¥åŠå†…å­˜ã€å¤–è®¾ã€å’Œæ¥è‡ªè½¯ä»¶çš„è¾“å…¥/è¾“å‡ºè¯·æ±‚ï¼Œå°†ä»–ä»¬è½¬æ¢ä¸º CPU çš„æ•°æ®å¤„ç†æŒ‡ä»¤ã€‚

## Kernel ç»„æˆ åŠ ç³»ç»Ÿè°ƒç”¨

Linux å†…æ ¸ç”±å¦‚ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼šå†…å­˜ç®¡ç†ã€è¿›ç¨‹ç®¡ç†ã€è®¾å¤‡é©±åŠ¨ç¨‹åºç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿç®¡ç†ã€ç½‘ç»œç®¡ç†ç­‰ã€‚å¦‚å›¾ï¼š
![](https://notes-learning.oss-cn-beijing.aliyuncs.com/fkp6xi/1616168349819-c21dd43c-79b7-4ec2-abd4-c8bb0e3c7686.jpeg)
**System Call Interface(ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼Œç®€ç§° SCI) **å±‚æä¾›äº†æŸäº›æœºåˆ¶æ‰§è¡Œä»ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸çš„å‡½æ•°è°ƒç”¨ã€‚è¿™ä¸ªæ¥å£ä¾èµ–äºä½“ç³»ç»“æ„ï¼Œç”šè‡³åœ¨ç›¸åŒçš„å¤„ç†å™¨å®¶æ—å†…ä¹Ÿæ˜¯å¦‚æ­¤ã€‚SCI å®é™…ä¸Šæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‡½æ•°è°ƒç”¨å¤šè·¯å¤ç”¨å’Œå¤šè·¯åˆ†è§£æœåŠ¡ã€‚

ç³»ç»Ÿè°ƒç”¨ä»‹ç»è¯¦è§[ system call(ç³»ç»Ÿè°ƒç”¨)](âœIT å­¦ä¹ ç¬”è®°/ğŸ“„1.æ“ä½œç³»ç»Ÿ/2.Kernel(å†…æ ¸)/3.System%20Call(ç³»ç»Ÿè°ƒç”¨).md Call(ç³»ç»Ÿè°ƒç”¨).md) ç« èŠ‚

## Linux man æ‰‹å†Œä½¿ç”¨è¯´æ˜

åœ¨ Linux Kernel çš„å®˜æ–¹ man æ‰‹å†Œä¸­ï¼Œè®°å½•äº†ç”¨æˆ·ç©ºé—´ç¨‹åºä½¿ç”¨ Linux å†…æ ¸ å’Œ C åº“çš„æ¥å£ã€‚å¯¹äº C åº“ï¼Œä¸»è¦èšç„¦äº GUN C(glibc)ï¼Œå°½ç®¡åœ¨å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œè¿˜åŒ…æ‹¬å¯ç”¨äº Linux çš„å…¶ä»– C åº“ä¸­çš„å˜ä½“æ–‡æ¡£ã€‚åœ¨è¿™ä¸ª man æ‰‹å†Œä¸­ï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ éƒ¨åˆ†

- **[User commands](https://man7.org/linux/man-pages/dir_section_1.html)(ç”¨æˆ·å‘½ä»¤)** # ä»‹ç»ä¸€äº›ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºã€‚
- **[System calls](https://man7.org/linux/man-pages/dir_section_2.html)(ç³»ç»Ÿè°ƒç”¨)** # Linux Kernel å¯ä»¥æä¾›çš„æ‰€æœ‰ System Calls(ç³»ç»Ÿè°ƒç”¨)
- **[Library functions](https://man7.org/linux/man-pages/dir_section_3.html)(åº“å‡½æ•°)** # C æ ‡å‡†åº“å¯ä»¥æä¾›çš„å‡½æ•°ã€‚
- **[Devices](https://man7.org/linux/man-pages/dir_section_4.html)(è®¾å¤‡)** # å„ç§è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿™äº›è®¾å¤‡å¤§å¤šéƒ½åœ¨ /dev ç›®å½•ä¸­ã€‚
- **[Files](https://man7.org/linux/man-pages/dir_section_5.html)(æ–‡ä»¶)** # å„ç§æ–‡ä»¶æ ¼å¼å’Œæ–‡ä»¶ç³»ç»Ÿ
- **[Overviews, conventions, and miscellaneous](https://man7.org/linux/man-pages/dir_section_7.html)(æ¦‚è¿°ã€çº¦å®š å’Œ å…¶ä»–)** #
- **[Superuser and system administration commands](https://man7.org/linux/man-pages/dir_section_8.html)(è¶…çº§ç”¨æˆ·å’Œç³»ç»Ÿç®¡ç†å‘˜å‘½ä»¤)** # ä»‹ç»ä¸€äº› GUN C åº“æä¾›çš„ç¨‹åºã€‚

åœ¨ Linux man æ‰‹å†Œä¸­ï¼Œå¯ä»¥æ‰¾åˆ° Linux ç³»ç»Ÿä¸­çš„ä¸€åˆ‡ä½¿ç”¨è¯´æ˜ã€‚Linux æ“ä½œç³»ç»Ÿå›´ç»• Linux Kernel æ„å»ºäº†ä¸€å¥—é«˜æ•ˆã€å¥å£®çš„åº”ç”¨ç¨‹åºè¿è¡Œç¯å¢ƒ

# intird.imgã€vmlinuzã€System.map æ–‡ä»¶

Kernel ä¼šè¢«å®‰è£…åˆ° /boot ç›®å½•ä¸­ï¼Œå¹¶ç”Ÿæˆ **configã€initrd.imgã€System.mapã€vmlinuz** è¿™å‡ ä¸ªæ–‡ä»¶

## vmlinuz

\_vmlinuz \_æ˜¯ [Linux](http://www.linfo.org/linuxdef.html) [_å†…æ ¸_](http://www.linfo.org/kernel.html) \_å¯æ‰§è¡Œæ–‡ä»¶\_çš„åç§°ã€‚

vmlinuz æ˜¯ä¸€ä¸ªå‹ç¼©çš„ Linux å†…æ ¸ï¼Œå®ƒæ˜¯\_å¯å¼•å¯¼çš„\_ã€‚å¯å¼•å¯¼æ„å‘³ç€å®ƒèƒ½å¤Ÿå°†æ“ä½œç³»ç»ŸåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾¿è®¡ç®—æœºå˜å¾—å¯ç”¨å¹¶ä¸”å¯ä»¥è¿è¡Œåº”ç”¨ç¨‹åºã€‚

vmlinuz ä¸åº”ä¸\_vmlinux\_æ··æ·†ï¼Œåè€…æ˜¯éå‹ç¼©å’Œä¸å¯å¼•å¯¼å½¢å¼çš„å†…æ ¸ã€‚vmlinux é€šå¸¸åªæ˜¯ç”Ÿæˆ vmlinuz çš„ä¸­é—´æ­¥éª¤ã€‚

vmlinuz ä½äº\_/boot\_ç›®å½•ä¸­ï¼Œè¯¥ç›®å½•åŒ…å«å¼€å§‹å¼•å¯¼ç³»ç»Ÿæ‰€éœ€çš„æ–‡ä»¶ã€‚åä¸º\_vmlinuz\_çš„æ–‡ä»¶å¯èƒ½æ˜¯å®é™…çš„å†…æ ¸å¯æ‰§è¡Œæ–‡ä»¶æœ¬èº«ï¼Œä¹Ÿå¯èƒ½æ˜¯å†…æ ¸å¯æ‰§è¡Œæ–‡ä»¶çš„é“¾æ¥ï¼Œè¯¥é“¾æ¥å¯èƒ½å¸¦æœ‰è¯¸å¦‚\_/boot/vmlinuz-2.4.18-19.8.0\_ä¹‹ç±»çš„åç§°ï¼ˆå³ç‰¹å®šå†…æ ¸çš„åç§°ï¼‰å†…æ ¸ç‰ˆæœ¬ï¼‰ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨\_ls\_ [å‘½ä»¤](http://www.linfo.org/command.html)ï¼ˆå…¶ç›®çš„æ˜¯åˆ—å‡ºæŒ‡å®šç›®å½•çš„å†…å®¹ï¼‰åŠå…¶\_-l\_é€‰é¡¹ï¼ˆå®ƒå‘Šè¯‰ ls æä¾›æœ‰å…³æŒ‡å®šç›®å½•ä¸­æ¯ä¸ªå¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ï¼‰æ¥è½»æ¾ç¡®å®šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

> `ls -l /boot`

å¦‚æœ vmlinuz æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼ˆåŒ…æ‹¬å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ï¼Œåˆ™ç¬¬ä¸€åˆ—ä¸­æœ‰å…³å®ƒçš„ä¿¡æ¯å°†ä»¥è¿å­—ç¬¦å¼€å¤´ã€‚å¦‚æœæ˜¯é“¾æ¥ï¼Œå®ƒå°†ä»¥å­—æ¯\_l\_å¼€å¤´ã€‚
é€šè¿‡å‘å‡ºä»¥ä¸‹å‘½ä»¤ Â  æ¥\_ç¼–è¯‘\_Linux å†…æ ¸ï¼š

> `make bzImage`

è¿™ä¼šåœ¨ \_/usr/src/linux/arch/i386/linux/boot/ \_ç­‰ç›®å½•ä¸­åˆ›å»ºåä¸º\_bzImage\_çš„æ–‡ä»¶ã€‚

ç¼–è¯‘æ˜¯å°†å†…æ ¸çš„[_æºä»£ç _](http://www.linfo.org/source_code.html)ï¼ˆå³å†…æ ¸ç”±äººç±»ç¼–å†™çš„åŸå§‹å½¢å¼ï¼‰è½¬æ¢ä¸º\_ç›®æ ‡ä»£ç \_ï¼ˆè®¡ç®—æœºå¤„ç†å™¨å¯ä»¥ç›´æ¥ç†è§£ï¼‰ã€‚å®ƒç”±ç§°ä¸º[_ç¼–è¯‘å™¨_](http://www.linfo.org/compiler.html)çš„ä¸“é—¨ç¨‹åºæ‰§è¡Œï¼Œé€šå¸¸æ˜¯[_GCC_](http://www.linfo.org/gcc.html)ï¼ˆ[GNU](http://www.linfo.org/gnu.html)ç¼–è¯‘å™¨é›†åˆï¼‰ä¸­çš„ä¸€ä¸ªã€‚

ç„¶åä½¿ç”¨ \_cp _å‘½ä»¤å°† bzImage å¤åˆ¶åˆ° /boot ç›®å½•ï¼ŒåŒæ—¶ä½¿ç”¨è¯¸å¦‚ä»¥ä¸‹å‘½ä»¤ Â  é‡å‘½å\_vmlinuz_

> `cp /usr/src/linux/arch/i386/linux/boot/bzImage /boot/vmlinuz`

vmlinuz ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå‹ç¼©å›¾åƒã€‚å®ƒè¿˜å†…ç½®äº†\_gzip\_è§£å‹ç¼©å™¨ä»£ç ã€‚gzip æ˜¯[ç±» Unix](http://www.linfo.org/unix-like.html)æ“ä½œç³»ç»Ÿä¸Šæœ€æµè¡Œçš„å‹ç¼©å®ç”¨ç¨‹åºä¹‹ä¸€ã€‚

ä¸€ä¸ªåä¸º\_zImage\_æ–‡ä»¶çš„ç¼–è¯‘å†…æ ¸æ˜¯åœ¨ä¸€äº›è¾ƒæ—§çš„ç³»ç»Ÿä¸Šåˆ›å»ºçš„ï¼Œå¹¶ä¿ç•™åœ¨è¾ƒæ–°çš„ç³»ç»Ÿä¸Šä»¥å®ç°å‘åå…¼å®¹æ€§ã€‚zImage å’Œ bzImage éƒ½æ˜¯ç”¨ gzip å‹ç¼©çš„ã€‚åŒºåˆ«åœ¨äº zImage è§£å‹åˆ°\_ä½å†…å­˜\_ï¼ˆå³å‰ 640kBï¼‰ï¼ŒbzImage è§£å‹åˆ°\_é«˜å†…å­˜\_ï¼ˆ1MB ä»¥ä¸Šï¼‰ã€‚æœ‰ä¸€ä¸ªå¸¸è§çš„è¯¯è§£ï¼Œè®¤ä¸º bzImage æ˜¯ä½¿ç”¨\_bzip2\_å®ç”¨ç¨‹åºå‹ç¼©çš„ã€‚å®é™…ä¸Šï¼Œ_b\_åªä»£è¡¨\_big_ã€‚

_vmlinuz_ è¿™ä¸ªåå­—å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å†å²çš„å¶ç„¶ã€‚åœ¨è´å°”å®éªŒå®¤å¼€å‘çš„åŸå§‹ UNIX ä¸Šçš„å†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶ç§°ä¸º\_unix\_ã€‚å½“åæ¥åœ¨åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡ (UCB) ç¼–å†™åŒ…å«æ”¯æŒ[_è™šæ‹Ÿå†…å­˜_](http://www.linfo.org/virtual_memory.html)çš„æ–°å†…æ ¸æ—¶ï¼Œå†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶æ›´åä¸º\_vmunix\_ã€‚

è™šæ‹Ÿå†…å­˜æ˜¯ä½¿ç”¨ç¡¬ç›˜é©±åŠ¨å™¨ (HDD) ä¸Šçš„ç©ºé—´æ¥æ¨¡æ‹Ÿé¢å¤–çš„ RAMï¼ˆéšæœºå­˜å–å†…å­˜ï¼‰å®¹é‡ã€‚ä¸å½“æ—¶ä½¿ç”¨çš„å…¶ä»–ä¸€äº›æµè¡Œæ“ä½œç³»ç»Ÿï¼ˆä¾‹å¦‚[MS-DOSï¼‰](http://www.linfo.org/ms-dos.html)ç›¸æ¯”ï¼ŒLinux å†…æ ¸å‡ ä¹ä» Linux ä¸€å¼€å§‹å°±æ”¯æŒå®ƒã€‚

å› æ­¤ï¼ŒLinux å†…æ ¸å¾ˆè‡ªç„¶åœ°è¢«ç§°ä¸º\_vmlinux\_ã€‚ç”±äº Linux å†…æ ¸å¯æ‰§è¡Œæ–‡ä»¶è¢«åˆ¶ä½œæˆå‹ç¼©æ–‡ä»¶ï¼Œå¹¶ä¸”å‹ç¼©æ–‡ä»¶åœ¨ç±» Unix ç³»ç»Ÿä¸Šé€šå¸¸å…·æœ‰\_z\_æˆ–\_gz\_æ‰©å±•åï¼Œå› æ­¤å‹ç¼©å†…æ ¸å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°å˜ä¸º\_vmlinuz\_ã€‚

## initrd

**Initial RAM Disk(åˆå§‹å†…å­˜ç£ç›˜ï¼Œç®€ç§° initrd)** æ˜¯ä¸€ç§å°†ä¸´æ—¶æ ¹æ–‡ä»¶ç³»ç»ŸåŠ è½½åˆ°å†…å­˜ä¸­çš„æ–¹æ¡ˆï¼Œå¯ä»¥ä½œä¸º Linux å¯åŠ¨è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚æœ‰ä¸¤ç§æ–¹æ³•æ¥å®ç°è¿™ç§æ–¹æ¡ˆï¼š

- **initrd # Initial RAM Diskã€‚**å°±æ˜¯æŠŠä¸€å—å†…å­˜ï¼ˆramï¼‰å½“åšç£ç›˜ï¼ˆdiskï¼‰å»æŒ‚è½½ï¼Œç„¶åæ‰¾åˆ° ram é‡Œçš„ init æ‰§è¡Œã€‚
- **initramfs # Initial RAM Filesystemã€‚**ç›´æ¥åœ¨ ram ä¸ŠæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿä¸­çš„ initã€‚

è¿™ä¸¤è€…é€šå¸¸ç”¨äºåœ¨æŒ‚è½½çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»Ÿä¹‹å‰æ‰§è¡Œä¸€äº›å‡†å¤‡å·¥ä½œã€‚

> ä¸è¦è¢«æ–‡ä»¶åè¿·æƒ‘ï¼Œkernel 2.6 ä»¥æ¥éƒ½æ˜¯ initramfs äº†ï¼Œåªæ˜¯å¾ˆå¤šè¿˜æ²¿è¢­ä¼ ç»Ÿä½¿ç”¨ initrd çš„åå­—
> initramfs çš„å·¥ä½œæ–¹å¼æ›´åŠ ç®€å•ç›´æ¥ä¸€äº›ï¼Œå¯åŠ¨çš„æ—¶å€™åŠ è½½å†…æ ¸å’Œ initramfs åˆ°å†…å­˜æ‰§è¡Œï¼Œå†…æ ¸åˆå§‹åŒ–ä¹‹åï¼Œåˆ‡æ¢åˆ°ç”¨æˆ·æ€æ‰§è¡Œ initramfs çš„ç¨‹åº/è„šæœ¬ï¼ŒåŠ è½½éœ€è¦çš„é©±åŠ¨æ¨¡å—ã€å¿…è¦é…ç½®ç­‰ï¼Œç„¶ååŠ è½½ rootfs åˆ‡æ¢åˆ°çœŸæ­£çš„ rootfs ä¸Šå»æ‰§è¡Œåç»­çš„ init è¿‡ç¨‹ã€‚

> initrd æ˜¯ 2.4 åŠæ›´æ—©çš„ç”¨æ³•ï¼ˆç°åœ¨ä½ èƒ½è§åˆ°çš„ initrd æ–‡ä»¶å®é™…å·®ä¸å¤šéƒ½æ˜¯ initramfs äº†ï¼‰ï¼Œè¿è¡Œè¿‡ç¨‹å¤§æ¦‚æ˜¯å†…æ ¸å¯åŠ¨ï¼Œæ‰§è¡Œä¸€äº› initrd çš„å†…å®¹ï¼ŒåŠ è½½æ¨¡å—å•¥çš„ï¼Œç„¶åäº¤å›æ§åˆ¶æƒç»™å†…æ ¸ï¼Œæœ€åå†åˆ‡åˆ°ç”¨æˆ·æ€å»è¿è¡Œç”¨æˆ·æ€çš„å¯åŠ¨æµç¨‹ã€‚

> ä»æ ¼å¼çœ‹ï¼Œè€çš„ initrd æ˜¯ä¸€ä¸ªå‹ç¼©çš„å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œå…·ä½“æ˜¯å•¥å¿˜äº†ï¼Œå¹´æœˆå¤ªä¹…äº†ã€‚ç°åœ¨çš„ initramfs æ˜¯ä¸€ä¸ª gzip å‹ç¼©çš„ cpio æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…ï¼Œå¦‚æœé‡åˆ°ä»€ä¹ˆç´§æ€¥æƒ…å†µéœ€è¦å¤„ç†çš„æ—¶å€™ï¼Œä½ å¯ä»¥å»ºç«‹ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼ŒæŠŠ initramfs è§£å‹ä¹‹åï¼Œç›´æ¥ cpio -idv è§£å‹å‡ºæ¥ï¼Œæ”¹ä¹‹åå†ç”¨ cpio å’Œ gzip å°ä¸Šå³å¯ã€‚è™½ç„¶å¤§å®¶éƒ½å–œæ¬¢ç”¨ tar æ‰“åŒ…ï¼Œä½†æŒæ¡ç‚¹ cpio åœ¨å…³é”®æ—¶åˆ»è¿˜æ˜¯å¯ä»¥æ•‘å‘½çš„ã€‚

åœ¨æ—©æœŸçš„ Linux ç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬å°±åªæœ‰è½¯ç›˜æˆ–è€…ç¡¬ç›˜è¢«ç”¨æ¥ä½œä¸º Linux çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å¾ˆå®¹æ˜“æŠŠè¿™äº›è®¾å¤‡çš„é©±åŠ¨ç¨‹åºé›†æˆåˆ°å†…æ ¸ä¸­ã€‚ä½†æ˜¯ç°åœ¨æ ¹æ–‡ä»¶ç³»ç»Ÿå¯èƒ½ä¿å­˜åœ¨å„ç§å­˜å‚¨è®¾å¤‡ä¸Šï¼ŒåŒ…æ‹¬ SCSIã€SATAã€U ç›˜ç­‰ç­‰ã€‚æ€»ä¸èƒ½æ¯å‡ºä¸€ä¸ªï¼Œå°±è¦é‡æ–°ç¼–è¯‘ä¸€éå†…æ ¸å§ï¼Ÿ~è¿™æ ·ä¸ä½†éº»çƒ¦ï¼Œä¹Ÿä¸å®ç”¨ï¼Œæ‰€ä»¥åæ¥ Linux å°±æä¾›äº†ä¸€ä¸ªçµæ´»çš„æ–¹æ³•æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚å°±æ˜¯ **initrd**ã€‚

> å¯ä»¥æŠŠ initrd å½“åš WinPEã€‚å½“ä½¿ç”¨ WinPE å¯åŠ¨åä¼šå‘ç°ä½ çš„è®¡ç®—æœºå°±ç®—æ²¡æœ‰ç¡¬ç›˜ä¹Ÿèƒ½åœ¨æ­£å¸¸è¿è¡Œï¼Œå…¶ä¸­æœ‰ä¸ªæ–‡ä»¶ç³»ç»Ÿ B:/ åˆ†åŒºï¼Œè¿™ä¸ªåˆ†åŒºå°±æ˜¯å†…å­˜æ¨¡æ‹Ÿçš„ç£ç›˜ã€‚

initrd.img æ–‡ä»¶å°±æ˜¯ä¸ª ram disk çš„æ˜ åƒæ–‡ä»¶ã€‚ramdisk æ˜¯ç”¨ä¸€éƒ¨åˆ†å†…å­˜æ¨¡æ‹Ÿæˆç£ç›˜ï¼Œè®©æ“ä½œç³»ç»Ÿè®¿é—®ã€‚ram disk æ˜¯æ ‡å‡†å†…æ ¸æ–‡ä»¶è®¤è¯†çš„è®¾å¤‡(/dev/ram0)æ–‡ä»¶ç³»ç»Ÿä¹Ÿæ˜¯æ ‡å‡†å†…æ ¸è®¤è¯†çš„æ–‡ä»¶ç³»ç»Ÿã€‚å†…æ ¸åŠ è½½è¿™ä¸ª ram disk ä½œä¸ºæ ¹æ–‡ä»¶ç³»ç»Ÿå¹¶å¼€å§‹æ‰§è¡Œå…¶ä¸­çš„"æŸä¸ªæ–‡ä»¶"ï¼ˆ2.6 å†…æ ¸æ˜¯ init æ–‡ä»¶ï¼‰æ¥åŠ è½½å„ç§æ¨¡å—ï¼ŒæœåŠ¡ç­‰ã€‚ç»è¿‡ä¸€äº›é…ç½®å’Œè¿è¡Œåï¼Œå°±å¯ä»¥å»ç‰©ç†ç£ç›˜åŠ è½½çœŸæ­£çš„ root åˆ†åŒºäº†ï¼Œç„¶ååˆæ˜¯ä¸€äº›é…ç½®ç­‰ï¼Œæœ€åå¯åŠ¨æˆåŠŸã€‚

ä¹Ÿå°±æ˜¯ä½ åªéœ€è¦å®šåˆ¶é€‚åˆè‡ªå·±çš„ initrd.img æ–‡ä»¶å°±å¯ä»¥äº†ã€‚è¿™è¦æ¯”é‡ç¼–å†…æ ¸ç®€å•å¤šäº†ï¼Œçœæ—¶çœäº‹ä½é£é™©ã€‚

### æŸ¥çœ‹ initrd æ–‡ä»¶

æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ï¼Œè§£å‹å‡º initrd.img æ–‡ä»¶ï¼Œä¸‹é¢åˆ†åˆ«ä»¥ Ubuntu 20.04 TLS ç³»ç»Ÿå’Œ CentOS Stream 8 ç³»ç»Ÿä¸ºä¾‹ï¼š

> è§£å‹æ–¹æ³•æ¥æºï¼š<https://unix.stackexchange.com/questions/163346/why-is-it-that-my-initrd-only-has-one-directory-namely-kernel>

Ubuntu 20.04 TLS

```bash
root@lichenhao:~/test_dir# mkdir -p /root/test_dir/root
root@lichenhao:~/test_dir# cp /boot/initrd.img /root/test_dir/
root@lichenhao:~/test_dir/root# (cpio -id; cpio -i; unlz4 | cpio -id) < ../initrd.img
62 blocks
9004 blocks
450060 blocks
root@lichenhao:~/test_dir/root# ls
bin  conf  cryptroot  etc  init  kernel  lib  lib32  lib64  libx32  run  sbin  scripts  usr  var
```

CentOS Stream 8

```bash
[root@master-2 root]# mkdir -p /root/test_dir/root
[root@master-2 root]# cp /boot/initramfs-4.18.0-294.el8.x86_64.img /root/test_dir
[root@master-2 root]# cd /root/test_dir/root
[root@master-2 root]# (cpio -id; zcat | cpio -id) < ../initramfs-4.18.0-294.el8.x86_64.img

[root@master-2 root]# ls
bin  dev  early_cpio  etc  init  kernel  lib  lib64  proc  root  run  sbin  shutdown  sys  sysroot  tmp  usr  var
```

å¯ä»¥çœ‹åˆ°ï¼Œinitrd.img ä¸­åŒ…å«äº†ä¸€ä¸ªç³»ç»Ÿæœ€åŸºæœ¬çš„ç›®å½•ç»“æ„

# Kernel å…³è”æ–‡ä»¶

**/boot/\* **#

- **./config-$(uname -r) **# Kernel çš„æ‰©å±•é…ç½®æ–‡ä»¶ã€‚Kernel æ–‡æ¡£ä¸­ï¼Œå°†è¯¥æ–‡ä»¶ç§°ä¸º **Boot Configuration**ã€‚
- **./initrd.img** # åœ¨å†…æ ¸æŒ‚è½½çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»Ÿå‰ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ
- **./vmlinuz** # Linux å†…æ ¸

**/etc/sysctl.conf **# ç³»ç»Ÿå¯åŠ¨æ—¶è¯»å–çš„å†…æ ¸å‚æ•°æ–‡ä»¶

- **/etc/sysctl.d/\* **# ç³»ç»Ÿå¯åŠ¨æ—¶æ—¶è¯»å–çš„å†…æ ¸å‚æ•°ç›®å½•

**/usr/lib/sysctl.d/\* **#
**/proc/sys/\* **# å†…æ ¸å‚æ•°(ä¹Ÿç§°ä¸ºå†…æ ¸å˜é‡)æ‰€åœ¨è·¯å¾„ã€‚è¯¥ç›®å½•(ä» 1.3.57 ç‰ˆæœ¬å¼€å§‹)åŒ…å«è®¸å¤šä¸å†…æ ¸å˜é‡ç›¸å¯¹åº”çš„æ–‡ä»¶å’Œå­ç›®å½•ã€‚ å¯ä»¥ä½¿ç”¨ [proc æ–‡ä»¶ç³»ç»Ÿ](https://www.yuque.com/go/doc/33222789) ä»¥åŠ sysctl(2) ç³»ç»Ÿè¯»å–æˆ–åŠ è½½è¿™äº›å˜é‡ï¼Œæœ‰æ—¶å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚
